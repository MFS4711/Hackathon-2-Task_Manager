{% extends "base.html" %}

{% load static %}

{% block content %}
<div class="container content-container">
    <h1>Task Dashboard</h1>
    <h2>Welcome, {{ user.username }}</h2>

    <!-- Task List -->
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Category</th>
                <th>Due Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task.title }}</td>
                <td>{{ task.description }}</td>
                <td>{{ task.priority }}</td>
                <td>{{ task.status }}</td>
                <td>{{ task.category }}</td>
                <td>{{ task.due_date }}</td>
                <td>
                    <a href="{% url 'task_edit' user.id task.id %}">Edit</a> |
                    <a href="#" class="btn btn-danger delete-btn" data-task-id="{{ task.id }}"
                        data-user-id="{{ user.id }}" data-bs-toggle="modal" data-bs-target="#deleteModal"
                        aria-label="Delete task {{ task.id }}">Delete</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">No tasks found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Add Task Form -->
    <form method="POST">
        {% csrf_token %}
        {{ task_form.as_p }}
        <a href="{% url 'task_add' user.id %}">Add Task</a>
    </form>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Delete Task?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this task? This action cannot be undone.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        aria-label="Close">Close</button>
                    <a id="delete-confirm" href="#" class="btn btn-danger" aria-label="Confirm deletion">Delete</a>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block extras %}
<script src="{% static 'js/task_management.js' %}"></script>
{% endblock %}